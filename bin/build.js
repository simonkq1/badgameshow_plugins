const fs = require('fs')
const path = require('path')
const repl = require("node:repl");
const config = require("./tampermonkey.config.js")
const userscript = require("userscript-meta")
const package = require("../package.json")
const webpack_config = require("../webpack.config.js")


const filePath = path.resolve(__dirname,'..','build/app.js')
// console.log(filePath)
let text = fs.readFileSync(filePath,'utf8')
// console.log(text)
const banner = userscript.stringify(config)
// console.log(banner)
const fileName = webpack_config.output.filename.replace("[name]", package.name)
let userFileName = fileName.split(".")
userFileName.splice(1, 0, "user")
userFileName = userFileName.join(".")
let metaFileName = fileName.split(".")
metaFileName.splice(1, 0, "meta")
metaFileName = metaFileName.join(".")
let outputUserPath =  path.resolve(webpack_config.output.path,`${userFileName}`)
let outputMetaPath =  path.resolve(webpack_config.output.path,`${metaFileName}`)
fs.writeFileSync(outputMetaPath,banner)
fs.writeFileSync(outputUserPath,banner+"\n"+text+"\n")
// console.log(banner+text)
console.log('build finished')
